<!DOCTYPE html>
<html lang="en" class="bg-gray-100">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Florida Mortgagee Clause Directory</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/heroicons@2.0.18/dist/outline/index.js"></script>
    <style>
        /* Smooth transition for copy feedback */
        .copy-feedback { transition: all 0.3s ease; }
    </style>
</head>
<body class="text-gray-800 font-sans">

    <div class="max-w-5xl mx-auto px-4 py-8">
        <header class="mb-8 text-center">
            <h1 class="text-4xl font-extrabold text-slate-800 tracking-tight">Mortgagee Clause Lookup</h1>
            <p class="text-lg text-gray-600 mt-3">A directory of lender addresses and ISAOA/ATIMA wording for insurance certificates.</p>
        </header>

        <div class="sticky top-4 z-10 bg-gray-100 pt-2 pb-6">
            <div class="relative shadow-sm">
                <div class="pointer-events-none absolute inset-y-0 left-0 flex items-center pl-4">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6 text-gray-400">
                      <path stroke-linecap="round" stroke-linejoin="round" d="m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 1.061 1.061Z" />
                    </svg>
                </div>
                <input type="text" id="searchInput" placeholder="Search by lender, city, state or zip code..." 
                    class="block w-full rounded-xl border-0 py-4 pl-12 text-gray-900 shadow-lg ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-blue-600 sm:text-lg sm:leading-6">
            </div>
             <div id="resultCount" class="text-sm text-gray-500 mt-2 ml-2">Loading database...</div>
        </div>

        <div id="resultsList" class="space-y-4">
            </div>

        <div id="noResults" class="hidden text-center py-12">
             <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-16 h-16 mx-auto text-gray-300 mb-4">
               <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m9-.75a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9 3.75h.008v.008H12v-.008Z" />
             </svg>
            <p class="text-xl text-gray-500">No lenders found matching that search.</p>
        </div>

    </div>

    <script>
        const resultsList = document.getElementById('resultsList');
        const searchInput = document.getElementById('searchInput');
        const resultCount = document.getElementById('resultCount');
        const noResults = document.getElementById('noResults');
        let mortgageeData = [];

        // --- Fetch Data ---
        fetch('appsmith_data.mortgage_list.json')
            .then(response => response.json())
            .then(data => {
                mortgageeData = data;
                // Sort alphabetically by default
                mortgageeData.sort((a, b) => a.Name.localeCompare(b.Name));
                renderList(mortgageeData);
            })
            .catch(err => {
                console.error('Error loading JSON:', err);
                resultCount.textContent = "Error loading database file.";
                resultCount.classList.add('text-red-600');
            });


        // --- Render Functions ---
        function renderList(data) {
            resultsList.innerHTML = '';
            resultCount.textContent = `Showing ${data.length} lenders`;
            
            if (data.length === 0) {
                noResults.classList.remove('hidden');
            } else {
                noResults.classList.add('hidden');
            }

            data.forEach(item => {
                // Build Address String
                const fullAddressBlock = `${item.Address}<br>${item.City}, ${item.State} ${item.ZIP}`;
                // Build Copy String (Clean format for pasting)
                const copyText = `${item.Name}\n${item.Name2 || ''}\n${item.Address}\n${item.City}, ${item.State} ${item.ZIP}`;
                
                // Build Contact Info Section conditionally (only show if data exists)
                let contactInfoHTML = '';
                if (item.Telephone || item.FAX) {
                    contactInfoHTML = `<div class="mt-4 pt-4 border-t border-gray-100 flex flex-wrap gap-6 text-sm text-gray-600">`;
                    if (item.Telephone) {
                        contactInfoHTML += `<div class="flex items-center"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-4 h-4 mr-1 opacity-70"><path fill-rule="evenodd" d="M2 3.5A1.5 1.5 0 0 1 3.5 2h1.148a1.5 1.5 0 0 1 1.465 1.175l.716 3.223a1.5 1.5 0 0 1-1.052 1.767l-.933.267c-.41.117-.643.555-.48.95a11.542 11.542 0 0 0 6.254 6.254c.395.163.833-.07.95-.48l.267-.933a1.5 1.5 0 0 1 1.767-1.052l3.223.716A1.5 1.5 0 0 1 18 15.352V16.5a1.5 1.5 0 0 1-1.5 1.5H15c-1.149 0-2.263-.15-3.326-.43A13.022 13.022 0 0 1 2.43 8.326 13.019 13.019 0 0 1 2 5V3.5Z" clip-rule="evenodd" /></svg> Ph: ${item.Telephone}</div>`;
                    }
                    if (item.FAX) {
                        contactInfoHTML += `<div class="flex items-center"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-4 h-4 mr-1 opacity-70"><path fill-rule="evenodd" d="M5 2a1 1 0 0 1 1 1v1h8V3a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1h-2a1 1 0 0 1-1-1v-1H6v1a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3a1 1 0 0 1 1-1h2Zm1 3v10h8V5H6Z" clip-rule="evenodd" /></svg> Fax: ${item.FAX}</div>`;
                    }
                    contactInfoHTML += `</div>`;
                }

                // The Card Template
                const cardHTML = `
                    <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6 hover:shadow-md transition-shadow relative group">
                        <div class="md:flex md:justify-between md:items-start">
                            <div class="flex-1 pr-4">
                                <h2 class="text-2xl font-bold text-slate-900 mb-2">${item.Name}</h2>
                                <div class="bg-blue-50 text-blue-900 px-4 py-3 rounded-lg font-medium border-l-4 border-blue-500 mb-4 text-lg">
                                    ${item.Name2 ? item.Name2 : '<span class="text-blue-400 italic text-sm">No specific ISAOA/ATIMA clause on file.</span>'}
                                </div>
                                <address class="not-italic text-gray-600 leading-relaxed">
                                    ${fullAddressBlock}
                                </address>
                            </div>
                            <div class="mt-4 md:mt-0 shrink-0">
                                <button onclick="copyCard(this, \`${copyText.replace(/`/g, "\\`")}\`)" 
                                    class="copy-btn flex items-center justify-center w-full md:w-auto bg-slate-800 hover:bg-blue-700 text-white font-medium py-3 px-6 rounded-lg transition-all active:scale-95 shadow-sm">
                                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-5 h-5 mr-2">
                                      <path stroke-linecap="round" stroke-linejoin="round" d="M8.25 7.5V6.108c0-1.135.845-2.098 1.976-2.192.373-.03.748-.057 1.123-.08M15.75 18H18a2.25 2.25 0 0 0 2.25-2.25V6.108c0-1.135-.845-2.098-1.976-2.192a48.424 48.424 0 0 0-1.123-.08M15.75 18a2.25 2.25 0 0 1-2.25 2.25H6.75a2.25 2.25 0 0 1-2.25-2.25V6.75a2.25 2.25 0 0 1 2.25-2.25H6.75A2.25 2.25 0 0 1 4.5 4.5v10.5a2.25 2.25 0 0 0 2.25 2.25Zm.75-12h2.25m-2.25 12a2.25 2.25 0 0 0 2.25-2.25v-10.5a2.25 2.25 0 0 0-2.25-2.25h-2.25m0 12h-2.25" />
                                    </svg>
                                    <span class="btn-text">Copy for Dec Page</span>
                                </button>
                            </div>
                        </div>
                        ${contactInfoHTML}
                    </div>
                `;
                resultsList.insertAdjacentHTML('beforeend', cardHTML);
            });
        }

        // --- Search Logic (Debounced slightly for performance) ---
        let searchTimeout;
        searchInput.addEventListener('input', (e) => {
            clearTimeout(searchTimeout);
            searchTimeout = setTimeout(() => {
                const term = e.target.value.toLowerCase();
                 // Search across multiple relevant fields
                const filtered = mortgageeData.filter(item => 
                    (item.Name && item.Name.toLowerCase().includes(term)) || 
                    (item.City && item.City.toLowerCase().includes(term)) ||
                    (item.State && item.State.toLowerCase().includes(term)) ||
                    (item.ZIP && item.ZIP.toString().includes(term)) ||
                    // Also search the clause wording if they remember a specific phrase
                    (item.Name2 && item.Name2.toLowerCase().includes(term))
                );
                renderList(filtered);
            }, 150); 
        });

        // --- Copy Functionality with visual feedback ---
        function copyCard(button, text) {
            navigator.clipboard.writeText(text).then(() => {
                const originalHTML = button.innerHTML;
                button.innerHTML = `
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5 mr-2 text-green-300">
                      <path fill-rule="evenodd" d="M16.704 4.153a.75.75 0 0 1 .143 1.052l-8 10.5a.75.75 0 0 1-1.127.075l-4.5-4.5a.75.75 0 0 1 1.06-1.06l3.894 3.893 7.48-9.817a.75.75 0 0 1 1.05-.143Z" clip-rule="evenodd" />
                    </svg>
                    COPIED!
                `;
                button.classList.remove('bg-slate-800', 'hover:bg-blue-700');
                button.classList.add('bg-green-700');
                
                setTimeout(() => {
                    button.innerHTML = originalHTML;
                    button.classList.remove('bg-green-700');
                    button.classList.add('bg-slate-800', 'hover:bg-blue-700');
                }, 2000);
            });
        }
    </script>
</body>
</html>
